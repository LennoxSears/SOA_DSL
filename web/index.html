<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOA Rule Creator</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- js-yaml library for YAML parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ”§ SOA Rule Creator</h1>
            <p>Create universal SOA rules - model and monitor agnostic</p>
            <p class="header-note">Generate YAML specifications from device and monitor libraries</p>
        </header>

        <div class="loading" id="loading">
            <p>Loading device and monitor libraries...</p>
        </div>

        <div class="main-content" id="mainContent" style="display: none;">
            <!-- Left Panel: Rule Form -->
            <div class="panel form-panel">
                <h2>Create New SOA Rule</h2>
                
                <form id="ruleForm">
                    <!-- Step 1: Basic Information -->
                    <div class="form-section">
                        <h3>Step 1: Basic Information</h3>
                        
                        <div class="form-group">
                            <label for="ruleName">Rule Name *</label>
                            <input type="text" id="ruleName" placeholder="e.g., NMOS Core Oxide Risk" required>
                        </div>

                        <div class="form-group">
                            <label for="ruleDescription">Description</label>
                            <textarea id="ruleDescription" rows="2" placeholder="Brief description of this SOA rule"></textarea>
                        </div>
                    </div>

                    <!-- Step 2: Select Check Type -->
                    <div class="form-section">
                        <h3>Step 2: Select Check Type</h3>
                        
                        <div class="form-group">
                            <label for="checkType">Check Type *</label>
                            <select id="checkType" required>
                                <option value="">Select check type...</option>
                            </select>
                            <small id="checkTypeHelp" class="help-text"></small>
                        </div>
                    </div>

                    <!-- Step 3: Select Devices -->
                    <div class="form-section">
                        <h3>Step 3: Select Devices/Subcircuits</h3>
                        
                        <div class="form-group">
                            <label>Selection Method</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="deviceMethod" value="direct" checked>
                                    Direct Subcircuits
                                </label>
                                <label>
                                    <input type="radio" name="deviceMethod" value="level1">
                                    Level 1 Group
                                </label>
                                <label>
                                    <input type="radio" name="deviceMethod" value="level2">
                                    Level 2 Group
                                </label>
                            </div>
                        </div>

                        <!-- Direct Subcircuits -->
                        <div id="directSubcircuits" class="device-selection">
                            <label>Select Subcircuits *</label>
                            <div id="subcircuitList" class="checkbox-list"></div>
                        </div>

                        <!-- Level 1 Group -->
                        <div id="level1Groups" class="device-selection" style="display: none;">
                            <label>Select Level 1 Group *</label>
                            <select id="level1GroupSelect">
                                <option value="">Select group...</option>
                            </select>
                        </div>

                        <!-- Level 2 Group -->
                        <div id="level2Groups" class="device-selection" style="display: none;">
                            <label>Select Level 2 Group *</label>
                            <select id="level2GroupSelect">
                                <option value="">Select group...</option>
                            </select>
                        </div>

                        <div class="selected-devices">
                            <strong>Selected:</strong> <span id="selectedDevicesDisplay">None</span>
                        </div>
                    </div>

                    <!-- Step 4: Configure Check -->
                    <div class="form-section" id="checkConfig">
                        <h3>Step 4: Configure Check</h3>
                        <div id="checkConfigContent">
                            <!-- Dynamic content based on check type -->
                        </div>
                    </div>

                    <!-- Step 5: Set Limits -->
                    <div class="form-section">
                        <h3>Step 5: Set Limits</h3>
                        
                        <div class="form-group">
                            <label>Time Limit</label>
                            <select id="timeLimit">
                                <option value="steady">Steady State (never exceed)</option>
                                <option value="transient_1pct">Transient 1% (0.01 of time)</option>
                                <option value="transient_10pct">Transient 10% (0.10 of time)</option>
                                <option value="review">Review Only (-1)</option>
                            </select>
                        </div>

                        <div id="limitsConfig">
                            <!-- Dynamic content based on check type -->
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Add Rule</button>
                        <button type="button" class="btn btn-secondary" id="clearForm">Clear Form</button>
                    </div>
                </form>
            </div>

            <!-- Right Panel: YAML Preview -->
            <div class="panel preview-panel">
                <div class="panel-header">
                    <h2>Universal YAML Preview</h2>
                    <div class="panel-actions">
                        <button class="btn btn-small" id="copyYaml">Copy</button>
                        <button class="btn btn-small" id="downloadYaml">Download</button>
                    </div>
                </div>
                
                <pre id="yamlPreview" class="yaml-output">version: "1.0"
process: "SMOS10HV"
date: "2024-12-16"

globals:
  timing:
    tmin: 0
    tdelay: 0
    vballmsg: 1.0
    stop: 0
  time_limits:
    steady: 0
    transient_1pct: 0.01
    transient_10pct: 0.10
    review: -1

rules:
  # Add rules using the form
</pre>
            </div>
        </div>

        <!-- Rule List -->
        <div class="panel list-panel" id="ruleListPanel" style="display: none;">
            <h2>Added Rules (<span id="ruleCount">0</span>)</h2>
            <div id="ruleList" class="rule-list">
                <p class="empty-state">No rules added yet. Use the form above to create rules.</p>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
