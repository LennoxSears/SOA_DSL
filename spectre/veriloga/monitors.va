////////////////////////////////////////
// veriloga soa file for smos10hv ams3.12
// Developed by : circuit CAE
// Created on   : 09/16/2020 
// by           : Zhichen Zhang 
// NXP Internal Use Only  
//
// Copied from n16ff model. Changed two current probe from "-" to "+".
//
// Version update:
// version	time		comment
// ams3.12:	16/09/2020	veriloga module are updated to remove unnecessary lines. Also the output format changed.
// ams3.9:	28/09/2018	HCI-TDDB SOA modules are added for some powermosfets.
// ams3.6:	10/09/2017	monitor2t and monitor4t are added.
// ams1.2:	12/09/2014	startTime is enabled and vioInit is updated for average and sqrt average modules.
// 		10/24/2014	Irms rules are updated to support sqrt average current check.
//				threshold and pose-processed threshold post-fix words are added.
// ams1.1:	10/09/2014	Jmax rules are updated to support average current check.
// 		08/18/2014	"j" definition changed from "genvar" to be "integer".
// 		08/07/2014	Irms rules are supported, deltaT=5C.
// 		08/06/2014	Add Ipeak and Jmax rules for rhim, rhim_m, rnwsti and rnwsti_m. Irms rules are not
//				supported.
// 		06/27/2014	New soa model method is used. nch_hia18_mac is
//				added.
// ams1.0:	04/15/2014	First version.

`include "disciplines.h"
`define MONITOR_LOGFILE "soa.log"

module monitor2t(p1,p2);
input p1,p2;
electrical p1,p2;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
	end
	voltageV[1] = V(p1,p2);
	totalFlag = 0;
	for (j = 1; j < 2; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 1 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor4t(p1,p2,p3,p4);
input p1,p2,p3,p4;
electrical p1,p2,p3,p4;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
	end
	voltageV[1] = V(p1,p2);
	voltageV[2] = V(p3,p4);
	totalFlag = 0;
	for (j = 1; j < 3; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 2 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor6t(p1,p2,p3,p4,p5,p6);
input p1,p2,p3,p4,p5,p6;
electrical p1,p2,p3,p4,p5,p6;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
	end
	voltageV[1] = V(p1,p2);
	voltageV[2] = V(p3,p4);
	voltageV[3] = V(p5,p6);
	totalFlag = 0;
	for (j = 1; j < 4; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 3 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 4; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 4; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor8t(p1,p2,p3,p4,p5,p6,p7,p8);
input p1,p2,p3,p4,p5,p6,p7,p8;
electrical p1,p2,p3,p4,p5,p6,p7,p8;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
	end
	voltageV[1] = V(p1,p2);
	voltageV[2] = V(p3,p4);
	voltageV[3] = V(p5,p6);
	voltageV[4] = V(p7,p8);
	totalFlag = 0;
	for (j = 1; j < 5; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 4 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 5; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 5; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor(p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12);
input p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12;
electrical p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	voltageV[1] = V(p1,p2);
	voltageV[2] = V(p3,p4);
	voltageV[3] = V(p5,p6);
	voltageV[4] = V(p7,p8);	
	voltageV[5] = V(p9,p10);	
	voltageV[6] = V(p11,p12);	
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_cfmom(p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12);
input p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12;
electrical p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 

parameter   real hi1=0.07u;
parameter   real hi2=0.07u;
parameter   real hi3=0.07u;
parameter   real hi4=0.09u;
parameter   real hi5=0.09u;
parameter   real hi6=0.09u;
parameter   real hi7=0.15u;
parameter   real hi8=0.15u;
parameter   real hi9=1.15u;
parameter   real hi10=1.15u;
parameter   real hi11=2.8u;
         
parameter real nr=320;
parameter real lr=32u;
parameter real stm=1;
parameter real spm=3;
parameter real n_mxa=2;
parameter real myscale=1;
parameter real multi=1;
   
real area1, area2, mflag1, mflag2;
real hiflag1,hiflag2,hiflag3,hiflag4,hiflag5;
real hiflag6,hiflag7,hiflag8,hiflag9,hiflag10;
real hiflag11;
real mytemp;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		hiflag1=0;
		hiflag2=0;
		hiflag3=0;
		hiflag4=0;
		hiflag5=0;
		hiflag6=0;
		hiflag7=0;
		hiflag8=0;
		hiflag9=0;
		hiflag10=0;
		hiflag11=0;   
   
	   	mflag1=0;
		mflag2=0;
	   	area1=1e-6;
		area2=1e-6;
		mytemp=hi7+hi8+hi9+hi10+hi11+n_mxa;
		
	   	if((1>=stm) && (1<=spm)) 
			hiflag1=1;
		if((2>=stm) && (2<=spm)) 
		hiflag2=1;
		if((3>=stm) && (3<=spm)) 
			hiflag3=1;
		if((4>=stm) && (4<=spm)) 
			hiflag4=1;
		if((5>=stm) && (5<=spm)) 
			hiflag5=1;
		if((6>=stm) && (6<=spm)) 
			hiflag6=1;
  	 
   		if( (hiflag1+hiflag2)>0 ) begin
			mflag1=1;
			area1=(hi1*hiflag1+hi2*hiflag2)*(nr-1)*lr*myscale*multi;
		end
		if( (hiflag3+hiflag4+hiflag5+hiflag6)>0 ) begin
			mflag2=1;
			area2=(hi3*hiflag3+hi4*hiflag4+hi5*hiflag5+hi6*hiflag6)*(nr-1)*lr*myscale*multi;
		end

		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	voltageV[1] = V(p1,p2);
	voltageV[2] = V(p3,p4);
	voltageV[3] = V(p5,p6);
	voltageV[4] = V(p7,p8);	
	voltageV[5] = V(p9,p10);	
	voltageV[6] = V(p11,p12);	
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 ) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else begin
				if ( realParameter[j] == 1 ) begin
					realV[j] = mflag1;
				end else if ( realParameter[j] == 2 ) begin
					realV[j] = mflag2;
				end else if ( realParameter[j] == 3 ) begin
					realV[j] = area1;
				end else if ( realParameter[j] == 4 ) begin
					realV[j] = area2;
				end else begin
					realV[j] = realParameter[j];
				end
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule


module monitor_average(p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12);
input p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12;
electrical p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12;
parameter real startTime = 0;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
real dt, oldAbstime, realVInteg[1:6], totalTime;
integer j; 
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
		violInit = startTime;
		oldAbstime = 0.0;
		for (j = 1; j < 7; j = j + 1) begin
		   realVInteg[j] = 0.0;
		end
	end
	voltageV[1] = V(p1,p2);
	voltageV[2] = V(p3,p4);
	voltageV[3] = V(p5,p6);
	voltageV[4] = V(p7,p8);	
	voltageV[5] = V(p9,p10);	
	voltageV[6] = V(p11,p12);	
	dt = $abstime-oldAbstime;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 ) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
		end else begin
			realV[j] = 0;
		end
		if ( $abstime > startTime ) begin
			if ( j == 1 ) begin
				realVInteg[j] = realV[j]*dt+realVInteg[j];
			end else begin
				realVInteg[j] = realV[j];
			end
		end
		if ( abs(realV[j]) > abs(maxV[j]) ) maxV[j] = realV[j];
	end
	oldAbstime = $abstime;
	@(final_step) begin
		totalFlag = 0;
		totalTime = $abstime-startTime;
		if ($abstime==0) begin
			totalTime = 1;
		end
		for (j = 1; j < 7; j = j + 1) begin
			if ( monitorType[j] > 0 ) begin 
				if ($abstime==0) begin
					realVInteg[j] = maxV[j];
				end
				if ( j > 1 ) begin
					totalTime = 1;
				end
				if ( realVInteg[j]/totalTime > targetV[j] && ruleType[j] == 1 ) begin
					flag = 1;
				end else if ( realVInteg[j]/totalTime >= targetV[j] && ruleType[j] == 2 ) begin
					flag = 1;
				end else if ( realVInteg[j]/totalTime < targetV[j] && ruleType[j] == 3 ) begin
					flag = 1;
				end else if ( realVInteg[j]/totalTime <= targetV[j] && ruleType[j] == 4 ) begin
					flag = 1;
				end else if ( realVInteg[j]/totalTime == targetV[j] && ruleType[j] == 5 ) begin
					flag = 1;
				end else if ( realVInteg[j]/totalTime != targetV[j] && ruleType[j] == 6 ) begin
					flag = 1;
				end else begin
					flag = 0;
				end
				maxV[j] = realVInteg[j]/totalTime;
			end else begin
				flag = 1;
			end
			totalFlag = flag + totalFlag;
		end
		if ( totalFlag == 6 ) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule


module monitor_sqrt_average(p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12);
input p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12;
electrical p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12;
parameter real startTime = 0;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
real dt, oldAbstime, realVInteg[1:6], totalTime;
integer j; 
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
		violInit = startTime;
		oldAbstime = 0.0;
		for (j = 1; j < 7; j = j + 1) begin
		   realVInteg[j] = 0.0;
		end
	end
	voltageV[1] = V(p1,p2);
	voltageV[2] = V(p3,p4);
	voltageV[3] = V(p5,p6);
	voltageV[4] = V(p7,p8);	
	voltageV[5] = V(p9,p10);	
	voltageV[6] = V(p11,p12);	
	dt = $abstime-oldAbstime;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 ) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
		end else begin
			realV[j] = 0;
		end
		realV[j] = realV[j]*realV[j];
		if ( $abstime > startTime ) begin
			realVInteg[j] = realV[j]*dt+realVInteg[j];
		end
		if ( abs(realV[j]) > abs(maxV[j]) ) maxV[j] = realV[j];
	end
	oldAbstime = $abstime;
	@(final_step) begin
		totalFlag = 0;
		totalTime = $abstime-startTime;
		if ($abstime==0) begin
			totalTime = 1;
		end
		for (j = 1; j < 7; j = j + 1) begin
			if ( monitorType[j] > 0 ) begin 
				if ($abstime==0) begin
					realVInteg[j] = maxV[j];
				end
				if ( sqrt(realVInteg[j]/totalTime) > targetV[j] && ruleType[j] == 1 ) begin
					flag = 1;
				end else if ( sqrt(realVInteg[j]/totalTime) >= targetV[j] && ruleType[j] == 2 ) begin
					flag = 1;
				end else if ( sqrt(realVInteg[j]/totalTime) < targetV[j] && ruleType[j] == 3 ) begin
					flag = 1;
				end else if ( sqrt(realVInteg[j]/totalTime) <= targetV[j] && ruleType[j] == 4 ) begin
					flag = 1;
				end else if ( sqrt(realVInteg[j]/totalTime) == targetV[j] && ruleType[j] == 5 ) begin
					flag = 1;
				end else if ( sqrt(realVInteg[j]/totalTime) != targetV[j] && ruleType[j] == 6 ) begin
					flag = 1;
				end else begin
					flag = 0;
				end
				maxV[j] = sqrt(realVInteg[j]/totalTime);
			end else begin
				flag = 1;
			end
			totalFlag = flag + totalFlag;
		end
		if ( totalFlag == 6 ) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule


module soa_report_header;
	integer fp;
	analog begin
		@(initial_step) begin
			fp = $fopen(`MONITOR_LOGFILE, "w");
			$fwrite(fp,"Instance,Rule,Equation,Start,Stop,Duration,MaxOverValue,DeltaOverValue,Score\n");
		end
	end
endmodule // module


module monitor_drsf90_10hv(p,n,sub);
input p,n,sub;
electrical p,n,sub;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = min(90,90+V(p)-V(sub))+0*targetV_cond1;
	end
	voltageV[1] = V(n)-V(p);
	totalFlag = 0;
	for (j = 1; j < 2; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 1 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld45_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = V(g)-V(s); voltageV[2] = (V(d)-V(s))-1.5714*(V(g)-V(s))*(V(g)-V(s))+20.2*(V(g)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 3; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 2 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld45_he_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = V(g)-V(s); voltageV[2] = (V(d)-V(s))-0.6429*(V(g)-V(s))*(V(g)-V(s))+14.8*(V(g)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 3; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 2 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld45_tlp_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = V(g)-V(s); voltageV[2] = (V(d)-V(s))-0.5714*(V(g)-V(s))*(V(g)-V(s))+16.0*(V(g)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 3; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 2 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld65_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = V(g)-V(s); voltageV[2] = (V(d)-V(s))-0.7143*(V(g)-V(s))*(V(g)-V(s))+20.0*(V(g)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 3; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 2 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld90_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = V(g)-V(s); voltageV[2] = (V(d)-V(s))-2.5714*(V(g)-V(s))*(V(g)-V(s))+37.6*(V(g)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 3; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 2 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule


module monitor_pmos90_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter real w = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
real vdscrit, vds_worst_case,tao;
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
	end
	ruleNum_var = ruleNum;
	tao = V(b);
	tao = 10*pow(w/40.0,1/2.0)*exp(0.2/(8.617e-5*298)*(298/$temperature-1));
	vds_worst_case = -60.85+9.09*ln(tao);
	vdscrit = 24*(V(g)-V(s)+1.65)+vds_worst_case+(-16.2)*(0.38)*(exp((V(g)-V(s)+1.65)/(0.38))-1);
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = vdscrit-(V(d)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 2; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 1 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_pmos45_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter real w = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
real vdscrit, vds_worst_case,tao;
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
	end
	ruleNum_var = ruleNum;
	tao = V(b);
	tao = 10*pow(w/40.0,1/2.0)*exp(0.135/(8.617e-5*298)*(298/$temperature-1));
	vds_worst_case = -26.25+1.73*ln(tao);
	vdscrit = 8*(V(g)-V(s)+1.3)+vds_worst_case+(-16.2)*(0.4)*(exp((V(g)-V(s)+1.3)/(0.4))-1);
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = vdscrit-(V(d)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 2; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 1 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_pmoshs45_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter real w = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
real vdscrit, vds_worst_case,tao;
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
	end
	ruleNum_var = ruleNum;
	tao = V(b);
	tao = 10*pow(w/40.0,1/2.0)*exp(0.135/(8.617e-5*298)*(298/$temperature-1));
	vds_worst_case = -26.25+1.73*ln(tao);
	vdscrit = 9*(V(g)-V(s)+1.4)+vds_worst_case+(-16.2)*(0.5)*(exp((V(g)-V(s)+1.4)/(0.5))-1);
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = vdscrit-(V(d)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 2; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 1 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_pld90_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter real w = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
real vdscrit, vds_worst_case,tao;
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
	end
	ruleNum_var = ruleNum;
	tao = 10*pow(w/40.0,1/2.18)*exp(0.13/(8.617e-5*298)*(298/$temperature-1));
	vds_worst_case = -28.3+2.43*ln(tao);
	vdscrit = 15*(V(g)-V(s)+1.35)+vds_worst_case+(-16.2)*(0.4)*(exp((V(g)-V(s)+1.35)/(0.4))-1);
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = vdscrit-(V(d)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 2; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 1 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule


module monitor_pld30_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter real w = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
real vdscrit, vds_worst_case,tao;
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
	end
	ruleNum_var = ruleNum;
	tao = 10*pow(w/40.0,1/2.0)*exp(0.135/(8.617e-5*298)*(298/$temperature-1));
	vds_worst_case = -26.8+1.455*ln(tao);
	vdscrit = 7.5*(V(g)-V(s)+1.1)+vds_worst_case+(-16.2)*(0.37)*(exp((V(g)-V(s)+1.1)/(0.37))-1);
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = vdscrit-(V(d)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 2; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 1 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 2; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule


module monitor_pld45b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter real w = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
real vdscrit, vds_worst_case,tao;
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
	end
	ruleNum_var = ruleNum;
	tao = 10*pow(w/40.0,1/2.0)*exp(0.146/(8.617e-5*298)*(298/$temperature-1));
	vds_worst_case = -20.4+1.43*ln(tao);
	vdscrit = 14.0*(V(g)-V(s)+2.15)+vds_worst_case+(-16.2)*(0.6)*(exp((V(g)-V(s)+2.15)/(0.6))-1);
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = V(s)-V(d); voltageV[2] = (V(s)-V(d)) + (5.6*(V(s)-V(g))-70); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = vdscrit-(V(d)-V(s)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 3; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 2 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld100_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
  
// just to allow CASE stack to compile in Mica 10.X
real ruleNum_var;

  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s)-V(sub));
	1: begin voltageV[1] = V(d)-V(s); voltageV[2] = (V(d)-V(s)) + (15.227*(V(g)-V(s))-143.54); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 3; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 2 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 3; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld30b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(d)-V(s); voltageV[2] = (V(d)-V(s)) + (4.8691*(V(g)-V(s))-49.601); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld45b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(d)-V(s); voltageV[2] = (V(d)-V(s)) + (8.455*(V(g)-V(s))-76.332); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld45b_he_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(d)-V(s); voltageV[2] = (V(d)-V(s)) + (7.03*(V(g)-V(s))-82.555); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld45b_tlp_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(d)-V(s); voltageV[2] = (V(d)-V(s)) + (10.545*(V(g)-V(s))-97.328); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld65b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(d)-V(s); voltageV[2] = (V(d)-V(s)) + (10.45*(V(g)-V(s))-110.68); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nld90b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(d)-V(s); voltageV[2] = (V(d)-V(s)) + (19.095*(V(g)-V(s))-160.88); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_pld45_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(s)-V(d); voltageV[2] = (V(s)-V(d)) + (4.75*(V(s)-V(g))-66.025); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_pld120_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(s)-V(d); voltageV[2] = (V(s)-V(d)) + (9.084*(V(s)-V(g))-161.22); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = V(s)-V(d); voltageV[2] = 100; voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nmos45b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(d)-V(s); voltageV[2] = (V(d)-V(s)) + (6.4*(V(g)-V(s))-77.12); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_nmos120_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = V(d)-V(s); voltageV[2] = (V(d)-V(s)) + (9.0833*(V(g)-V(s))-144.54); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule
