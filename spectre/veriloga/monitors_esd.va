////////////////////////////////////////
// veriloga esd soa file for smos10hv v16
// Developed by : circuit CAE
// Created on   : 09/15/2023 
// by           : nxa23194 
// Freescale Internal Use Only  
//
// Version update:
// version	time		comment
// v16    :     09/15/2023      ESD SOA model for dpldd, nmos120, pld120, cfr120 and cfr120_m1m2m3 are added.
// v14    :     05/05/2022      model updated.
// ams3.12:     09/29/2020      nmos_ull, pmos_ull, nld100, pld100 added. nld5, dz5, dz5b and rpoly rule updated.
//                              Output format changed.
// ams3.10:     01/29/2019      all rules updated.
// ams3.8:      06/16/2018      all rules updated.
// ams3.7:      03/02/2018      rules for nld30, nld45*, nld65 are updated.
// ams3.5:      04/27/2017      pld10b and pnp_iso ESD SOA added. pld45 ESD SOA updated.
// ams3.3:      10/26/2016      nmosll and pmosll ESD SOA added.
// ams3.2	09/02/2016      In case statement, default part is updated for Mica.
// ams2.4	07/29/2015      Use a variable instead of a parameter in CASE statements to allow
//                              modules to compile in Mica versions prior to 11.0.0.
//                              Compiled code can run 10X faster and use 10X less memory than.
//                              interpreted code.
// ams2.3:	05/20/2015	Initial version. drsf90 rules are also added here.
//

`include "disciplines.h"
`define MONITOR_LOGFILE "soa.log"

module monitor_esd_nmos_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-5.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.2*(V(g)-V(s)-0.0))-5.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.2*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-4.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-4.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos_ll_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-5.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.2*(V(g)-V(s)-0.0))-5.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.2*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-4.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.2*(V(g)-V(s)-0.5))-4.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.2*(V(g)-V(s)-0.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-4.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-4.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos_ull_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-5.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.2*(V(g)-V(s)-0.0))-5.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.2*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-4.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.2*(V(g)-V(s)-0.5))-4.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.2*(V(g)-V(s)-0.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-4.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-4.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos_ana_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-7.3); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.8*(V(g)-V(s)-0.0))-7.3); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.8*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-6.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5))-6.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-6.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.4*(V(g)-V(s)-1.0))-6.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.4*(V(g)-V(s)-1.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-6.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.2*(V(g)-V(s)-1.5))-6.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.2*(V(g)-V(s)-1.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-6.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-6.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos3_zvt_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-8.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-8.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-8.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-8.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos5_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-12.6); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.6*(V(g)-V(s)-0.0))-12.6); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.6*(V(g)-V(s)-0.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-12.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.4*(V(g)-V(s)-0.5))-12.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.4*(V(g)-V(s)-0.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-12.1); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.6*(V(g)-V(s)-1.0))-12.1); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.6*(V(g)-V(s)-1.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-10.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.2*(V(g)-V(s)-1.5))-10.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.2*(V(g)-V(s)-1.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-10.2); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-10.2); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-10.2); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.4*(V(g)-V(s)-0.0))-10.2); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.4*(V(g)-V(s)-0.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	24: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-9.0); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	26: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.8*(V(g)-V(s)-0.5))-9.0); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.8*(V(g)-V(s)-0.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	28: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-8.1); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	30: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.4*(V(g)-V(s)-1.0))-8.1); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.4*(V(g)-V(s)-1.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	32: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-7.9); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	33: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	34: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.2*(V(g)-V(s)-1.5))-7.9); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	35: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.2*(V(g)-V(s)-1.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	36: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-7.8); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	37: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	38: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.5*(V(g)-V(s)-2.0))-7.8); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	39: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.5*(V(g)-V(s)-2.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	40: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-7.3); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	41: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	42: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-7.3); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos10_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-24.5); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-24.5); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-24.5); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5))-24.5); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-24.5); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-1.0))-24.5); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-1.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-24.5); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-2.0))-24.5); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-2.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-24.5); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-3.0))-24.5); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-3.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-24.5); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.4*(V(g)-V(s)-4.0))-24.5); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.4*(V(g)-V(s)-4.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-24.1); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.0*(V(g)-V(s)-5.0))-24.1); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.0*(V(g)-V(s)-5.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-23.1); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.2*(V(g)-V(s)-6.0))-23.1); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	32: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.2*(V(g)-V(s)-6.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	33: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-21.9); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	34: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	35: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-21.9); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	36: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-18.5); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	37: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	38: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.6*(V(g)-V(s)-0.0))-18.5); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	39: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.6*(V(g)-V(s)-0.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	40: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-18.2); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	41: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	42: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.0*(V(g)-V(s)-0.5))-18.2); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	43: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.0*(V(g)-V(s)-0.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	44: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-17.7); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	45: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	46: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.9*(V(g)-V(s)-1.0))-17.7); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	47: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.9*(V(g)-V(s)-1.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	48: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-16.8); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	49: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	50: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.7*(V(g)-V(s)-2.0))-16.8); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	51: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.7*(V(g)-V(s)-2.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	52: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-16.1); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	53: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	54: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.1*(V(g)-V(s)-3.0))-16.1); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	55: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.1*(V(g)-V(s)-3.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	56: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-15.0); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	57: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	58: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.2*(V(g)-V(s)-4.0))-15.0); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	59: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.2*(V(g)-V(s)-4.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	60: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-13.8); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	61: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	62: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.7*(V(g)-V(s)-5.0))-13.8); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	63: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.7*(V(g)-V(s)-5.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	64: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-13.1); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	65: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	66: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.7*(V(g)-V(s)-6.0))-13.1); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	67: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.7*(V(g)-V(s)-6.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	68: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-12.4); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	69: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	70: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-12.4); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos45_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-76.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-76.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-76.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.4*(V(g)-V(s)-0.5))-76.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.4*(V(g)-V(s)-0.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-76.1); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.8*(V(g)-V(s)-1.0))-76.1); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.8*(V(g)-V(s)-1.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-74.2); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.4*(V(g)-V(s)-1.5))-74.2); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.4*(V(g)-V(s)-1.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-73.0); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(5.2*(V(g)-V(s)-2.0))-73.0); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(5.2*(V(g)-V(s)-2.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-67.8); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(4.6*(V(g)-V(s)-3.0))-67.8); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(4.6*(V(g)-V(s)-3.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-63.2); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.6*(V(g)-V(s)-4.0))-63.2); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.6*(V(g)-V(s)-4.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-56.6); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(12.0*(V(g)-V(s)-5.0))-56.6); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	32: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(12.0*(V(g)-V(s)-5.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	33: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-44.6); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	34: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	35: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.7*(V(g)-V(s)-6.0))-44.6); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	36: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.7*(V(g)-V(s)-6.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	37: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-37.9); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	38: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	39: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-37.9); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	40: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-72.0); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	41: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	42: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-1.0*(V(g)-V(s)-0.0))-72.0); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	43: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-1.0*(V(g)-V(s)-0.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	44: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-72.5); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	45: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	46: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.4*(V(g)-V(s)-0.5))-72.5); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	47: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.4*(V(g)-V(s)-0.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	48: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-72.3); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	49: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	50: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(24.0*(V(g)-V(s)-1.0))-72.3); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	51: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(24.0*(V(g)-V(s)-1.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	52: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-60.3); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	53: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	54: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.7*(V(g)-V(s)-1.5))-60.3); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	55: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.7*(V(g)-V(s)-1.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	56: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = abs(V(d)-V(s)-61.0); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	57: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	58: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(4.4*(V(g)-V(s)-2.5))-61.0); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	59: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(4.4*(V(g)-V(s)-2.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	60: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-56.6); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	61: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	62: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(7.4*(V(g)-V(s)-3.5))-56.6); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	63: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(7.4*(V(g)-V(s)-3.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	64: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-49.2); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	65: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	66: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(5.7*(V(g)-V(s)-4.5))-49.2); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	67: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(5.7*(V(g)-V(s)-4.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	68: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-43.5); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	69: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	70: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.2*(V(g)-V(s)-5.5))-43.5); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	71: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.2*(V(g)-V(s)-5.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	72: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-42.4); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	73: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	74: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.4*(V(g)-V(s)-6.0))-42.4); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	75: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.4*(V(g)-V(s)-6.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	76: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-36.0); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	77: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	78: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-36.0); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos45b_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-78.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-78.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-78.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5))-78.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-78.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.4*(V(g)-V(s)-1.0))-78.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.4*(V(g)-V(s)-1.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-76.6); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.4*(V(g)-V(s)-1.5))-76.6); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.4*(V(g)-V(s)-1.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = abs(V(d)-V(s)-73.2); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(4.1*(V(g)-V(s)-2.5))-73.2); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(4.1*(V(g)-V(s)-2.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-69.1); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(5.4*(V(g)-V(s)-3.5))-69.1); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(5.4*(V(g)-V(s)-3.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-63.7); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.5*(V(g)-V(s)-4.5))-63.7); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.5*(V(g)-V(s)-4.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-57.2); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-57.2); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	32: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-69.8); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	33: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	34: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.4*(V(g)-V(s)-0.0))-69.8); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	35: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.4*(V(g)-V(s)-0.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	36: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-69.1); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	37: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	38: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.8*(V(g)-V(s)-0.5))-69.1); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	39: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.8*(V(g)-V(s)-0.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	40: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-67.2); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	41: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	42: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(4.2*(V(g)-V(s)-1.0))-67.2); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	43: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(4.2*(V(g)-V(s)-1.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	44: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-65.1); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	45: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	46: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.2*(V(g)-V(s)-1.5))-65.1); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	47: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.2*(V(g)-V(s)-1.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	48: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = abs(V(d)-V(s)-63.9); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	49: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	50: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.2*(V(g)-V(s)-2.5))-63.9); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	51: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.2*(V(g)-V(s)-2.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	52: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-57.7); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	53: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	54: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(8.0*(V(g)-V(s)-3.5))-57.7); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	55: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(8.0*(V(g)-V(s)-3.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	56: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-49.7); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	57: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	58: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(7.1*(V(g)-V(s)-4.5))-49.7); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	59: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(7.1*(V(g)-V(s)-4.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	60: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-42.6); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	61: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	62: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-42.6); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos90_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-135.0); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-135.0); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-135.0); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.6*(V(g)-V(s)-0.5))-135.0); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.6*(V(g)-V(s)-0.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-134.7); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.9*(V(g)-V(s)-1.0))-134.7); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.9*(V(g)-V(s)-1.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-133.8); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.8*(V(g)-V(s)-2.0))-133.8); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.8*(V(g)-V(s)-2.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-133.0); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.7*(V(g)-V(s)-3.0))-133.0); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.7*(V(g)-V(s)-3.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-130.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.0*(V(g)-V(s)-4.0))-130.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.0*(V(g)-V(s)-4.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-127.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.5*(V(g)-V(s)-5.0))-127.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.5*(V(g)-V(s)-5.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-123.8); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-123.8); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	32: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-107.9); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	33: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	34: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(16.2*(V(g)-V(s)-0.0))-107.9); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	35: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(16.2*(V(g)-V(s)-0.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	36: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-99.8); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	37: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	38: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(5.8*(V(g)-V(s)-0.5))-99.8); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	39: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(5.8*(V(g)-V(s)-0.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	40: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-96.9); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	41: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	42: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(8.0*(V(g)-V(s)-1.0))-96.9); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	43: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(8.0*(V(g)-V(s)-1.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	44: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-88.9); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	45: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	46: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(7.4*(V(g)-V(s)-2.0))-88.9); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	47: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(7.4*(V(g)-V(s)-2.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	48: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-81.5); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	49: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	50: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(11.2*(V(g)-V(s)-3.0))-81.5); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	51: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(11.2*(V(g)-V(s)-3.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	52: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-70.3); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	53: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	54: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(7.9*(V(g)-V(s)-4.0))-70.3); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	55: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(7.9*(V(g)-V(s)-4.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	56: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-62.4); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	57: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	58: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-1.6*(V(g)-V(s)-5.0))-62.4); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	59: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-1.6*(V(g)-V(s)-5.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	60: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-64.0); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	61: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	62: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-64.0); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos90b_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-135.0); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.8*(V(g)-V(s)-0.0))-135.0); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.8*(V(g)-V(s)-0.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-133.8); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-1.5))-133.8); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-1.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-133.8); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.8*(V(g)-V(s)-2.0))-133.8); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.8*(V(g)-V(s)-2.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-133.0); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.7*(V(g)-V(s)-3.0))-133.0); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.7*(V(g)-V(s)-3.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-130.3); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.1*(V(g)-V(s)-4.0))-130.3); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.1*(V(g)-V(s)-4.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-127.2); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.8*(V(g)-V(s)-5.0))-127.2); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.8*(V(g)-V(s)-5.0)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-123.8); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-5.5))-123.8); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-5.5)); voltageV[4] = abs(V(b)-V(s)); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-123.8); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-123.8); voltageV[3] = abs(V(b)-V(s)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	32: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-110.1); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	33: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	34: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.5*(V(g)-V(s)-0.0))-110.1); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	35: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.5*(V(g)-V(s)-0.0)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	36: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-107.8); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	37: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	38: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(15.6*(V(g)-V(s)-1.5))-107.8); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	39: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(15.6*(V(g)-V(s)-1.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	40: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = abs(V(d)-V(s)-92.2); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	41: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	42: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(5.2*(V(g)-V(s)-2.5))-92.2); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	43: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(5.2*(V(g)-V(s)-2.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	44: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-87.0); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	45: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	46: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(10.4*(V(g)-V(s)-3.5))-87.0); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	47: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(10.4*(V(g)-V(s)-3.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	48: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-76.6); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	49: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	50: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.1*(V(g)-V(s)-4.5))-76.6); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	51: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.1*(V(g)-V(s)-4.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	52: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-74.5); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	53: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	54: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-5.5))-74.5); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	55: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-5.5)); voltageV[4] = V(b)-V(s); voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	56: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-74.5); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	57: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	58: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-74.5); voltageV[3] = V(b)-V(s); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld5_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-10.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-10.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-10.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5))-10.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-10.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.1*(V(g)-V(s)-1.0))-10.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.1*(V(g)-V(s)-1.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-8.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-2.0))-8.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-2.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-8.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-3.0))-8.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-3.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-8.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-8.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld5_lvt_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-9.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.8*(V(g)-V(s)-0.0))-9.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.8*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-9.3); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.6*(V(g)-V(s)-0.5))-9.3); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.6*(V(g)-V(s)-0.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-8.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-8.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld10_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-22.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.0*(V(g)-V(s)-0.0))-22.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-22.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.2*(V(g)-V(s)-0.5))-22.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.2*(V(g)-V(s)-0.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-21.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.9*(V(g)-V(s)-5.0))-21.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.9*(V(g)-V(s)-5.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-20.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.7*(V(g)-V(s)-6.0))-20.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.7*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-20.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-20.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld30_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-49.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.6*(V(g)-V(s)-0.0))-49.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.6*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-49.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.0*(V(g)-V(s)-1.0))-49.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.0*(V(g)-V(s)-1.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-47.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.6*(V(g)-V(s)-2.0))-47.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.6*(V(g)-V(s)-2.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-43.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.2*(V(g)-V(s)-3.0))-43.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.2*(V(g)-V(s)-3.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-42.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.7*(V(g)-V(s)-4.0))-42.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.7*(V(g)-V(s)-4.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-35.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.9*(V(g)-V(s)-5.0))-35.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.9*(V(g)-V(s)-5.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-32.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.6*(V(g)-V(s)-6.0))-32.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.6*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-26.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-26.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld30b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-49.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.6*(V(g)-V(s)-0.0))-49.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.6*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-49.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.0*(V(g)-V(s)-1.0))-49.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.0*(V(g)-V(s)-1.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-47.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.6*(V(g)-V(s)-2.0))-47.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.6*(V(g)-V(s)-2.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-43.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.2*(V(g)-V(s)-3.0))-43.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.2*(V(g)-V(s)-3.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-42.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.7*(V(g)-V(s)-4.0))-42.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.7*(V(g)-V(s)-4.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-35.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.9*(V(g)-V(s)-5.0))-35.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.9*(V(g)-V(s)-5.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-32.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.6*(V(g)-V(s)-6.0))-32.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.6*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-26.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-26.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld45_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-61.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.4*(V(g)-V(s)-0.0))-61.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.4*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-58.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.5*(V(g)-V(s)-1.5))-58.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.5*(V(g)-V(s)-1.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = abs(V(d)-V(s)-54.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(4.9*(V(g)-V(s)-2.5))-54.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(4.9*(V(g)-V(s)-2.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-49.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(5.1*(V(g)-V(s)-3.5))-49.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(5.1*(V(g)-V(s)-3.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-44.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(10.0*(V(g)-V(s)-4.5))-44.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(10.0*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-34.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(4.2*(V(g)-V(s)-5.5))-34.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(4.2*(V(g)-V(s)-5.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-32.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.7*(V(g)-V(s)-6.0))-32.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.7*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-25.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-25.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld45b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-61.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.4*(V(g)-V(s)-0.0))-61.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.4*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-58.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.5*(V(g)-V(s)-1.5))-58.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.5*(V(g)-V(s)-1.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = abs(V(d)-V(s)-54.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(4.9*(V(g)-V(s)-2.5))-54.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(4.9*(V(g)-V(s)-2.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-49.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(5.1*(V(g)-V(s)-3.5))-49.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(5.1*(V(g)-V(s)-3.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-44.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(10.0*(V(g)-V(s)-4.5))-44.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(10.0*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-34.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(4.2*(V(g)-V(s)-5.5))-34.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(4.2*(V(g)-V(s)-5.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-32.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.7*(V(g)-V(s)-6.0))-32.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.7*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-25.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-25.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld45_he_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-63.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-63.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-63.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.6*(V(g)-V(s)-3.5))-63.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.6*(V(g)-V(s)-3.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-63.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.0*(V(g)-V(s)-4.5))-63.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.0*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-62.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.0*(V(g)-V(s)-5.5))-62.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.0*(V(g)-V(s)-5.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-61.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.1*(V(g)-V(s)-6.0))-61.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.1*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-60.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-60.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld45b_he_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-63.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-63.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-63.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.6*(V(g)-V(s)-3.5))-63.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.6*(V(g)-V(s)-3.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-63.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.0*(V(g)-V(s)-4.5))-63.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.0*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-62.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.0*(V(g)-V(s)-5.5))-62.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.0*(V(g)-V(s)-5.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-61.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.1*(V(g)-V(s)-6.0))-61.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.1*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-60.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-60.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld45_tlp_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-69.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-69.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-69.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.6*(V(g)-V(s)-3.5))-69.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.6*(V(g)-V(s)-3.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-69.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.5*(V(g)-V(s)-4.5))-69.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.5*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-65.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.2*(V(g)-V(s)-5.5))-65.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.2*(V(g)-V(s)-5.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-64.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.4*(V(g)-V(s)-6.0))-64.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.4*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-61.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-61.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld45b_tlp_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-69.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-69.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-69.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.6*(V(g)-V(s)-3.5))-69.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.6*(V(g)-V(s)-3.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-69.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.5*(V(g)-V(s)-4.5))-69.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.5*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-65.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.2*(V(g)-V(s)-5.5))-65.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.2*(V(g)-V(s)-5.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-64.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.4*(V(g)-V(s)-6.0))-64.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.4*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-61.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-61.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld65_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-82.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-82.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-82.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.5*(V(g)-V(s)-4.5))-82.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.5*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-80.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.4*(V(g)-V(s)-5.5))-80.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.4*(V(g)-V(s)-5.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-80.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.1*(V(g)-V(s)-6.0))-80.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.1*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-78.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-78.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld65b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-82.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-82.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-82.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.5*(V(g)-V(s)-4.5))-82.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.5*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-80.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.4*(V(g)-V(s)-5.5))-80.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.4*(V(g)-V(s)-5.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-80.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.1*(V(g)-V(s)-6.0))-80.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.1*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-78.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-78.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld90_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-115.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-5.2*(V(g)-V(s)-0.0))-115.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-5.2*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-117.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-3.0*(V(g)-V(s)-0.5))-117.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-3.0*(V(g)-V(s)-0.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-119.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-9.4*(V(g)-V(s)-1.0))-119.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-9.4*(V(g)-V(s)-1.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-123.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(6.4*(V(g)-V(s)-1.5))-123.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(6.4*(V(g)-V(s)-1.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = abs(V(d)-V(s)-120.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-2.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.2*(V(g)-V(s)-2.0))-120.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.2*(V(g)-V(s)-2.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = abs(V(d)-V(s)-118.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-3.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.5*(V(g)-V(s)-3.0))-118.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.5*(V(g)-V(s)-3.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = abs(V(d)-V(s)-117.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-4.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-4.0))-117.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-4.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = abs(V(d)-V(s)-117.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-5.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.8*(V(g)-V(s)-5.0))-117.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	32: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.8*(V(g)-V(s)-5.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	33: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = abs(V(d)-V(s)-117.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	34: begin voltageV[1] = abs(V(g)-V(s)-6.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	35: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(0.3*(V(g)-V(s)-6.0))-117.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	36: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(0.3*(V(g)-V(s)-6.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	37: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = abs(V(d)-V(s)-116.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	38: begin voltageV[1] = abs(V(g)-V(s)-7.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	39: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-116.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld90b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-124.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-124.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nld100_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-133.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0))-133.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-133.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5))-133.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-133.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-1.0))-133.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-1.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-133.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-1.5))-133.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-1.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = abs(V(d)-V(s)-133.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-2.5))-133.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-2.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-133.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.0*(V(g)-V(s)-3.5))-133.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.0*(V(g)-V(s)-3.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-132.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(3.0*(V(g)-V(s)-4.5))-132.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(3.0*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-129.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-129.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-5.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-0.0))-5.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-5.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.4*(V(s)-V(g)-0.5))-5.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.4*(V(s)-V(g)-0.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-4.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-4.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos_ll_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-5.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-5.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-5.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-0.5))-5.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-0.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-4.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-4.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos_ull_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-5.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-5.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-5.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-0.5))-5.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-0.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-4.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-4.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos_ana_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-6.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-1.4*(V(s)-V(g)-0.0))-6.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-1.4*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-7.3); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-0.5))-7.3); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-0.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-7.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-1.0))-7.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-1.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-7.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-7.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos5_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-9.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.6*(V(s)-V(g)-0.0))-9.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.6*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-9.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-9.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos10_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-20.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-0.0))-20.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-19.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.5))-19.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-19.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-1.0))-19.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-1.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-19.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-1.5))-19.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-1.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)-19.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-19.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos45_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-63.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.1*(V(s)-V(g)-0.0))-63.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.1*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)-62.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.5*(V(s)-V(g)-3.0))-62.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.5*(V(s)-V(g)-3.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-4.0); voltageV[2] = abs(V(s)-V(d)-62.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-4.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.9*(V(s)-V(g)-4.0))-62.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.9*(V(s)-V(g)-4.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)-60.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.0*(V(s)-V(g)-5.0))-60.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.0*(V(s)-V(g)-5.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)-59.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.3*(V(s)-V(g)-6.0))-59.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.3*(V(s)-V(g)-6.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)-59.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-59.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos45b_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-68.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.4*(V(s)-V(g)-0.0))-68.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.4*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-68.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.5))-68.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-68.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.0*(V(s)-V(g)-1.0))-68.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.0*(V(s)-V(g)-1.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-67.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.7*(V(s)-V(g)-1.5))-67.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.7*(V(s)-V(g)-1.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)-64.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-2.5))-64.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-2.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)-62.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.5*(V(s)-V(g)-3.5))-62.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	24: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.5*(V(s)-V(g)-3.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	25: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)-61.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	26: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	27: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-4.5))-61.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	28: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-4.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	29: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)-59.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	30: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	31: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-59.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmoshs45_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-64.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-64.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-64.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-64.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmoshs45b_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-68.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.6*(V(s)-V(g)-0.0))-68.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.6*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)-66.3); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-66.3); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos90_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-119.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.7*(V(s)-V(g)-0.0))-119.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.7*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-2.0); voltageV[2] = abs(V(s)-V(d)-118.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-2.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.3*(V(s)-V(g)-2.0))-118.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.3*(V(s)-V(g)-2.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)-116.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.4*(V(s)-V(g)-3.0))-116.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.4*(V(s)-V(g)-3.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-4.0); voltageV[2] = abs(V(s)-V(d)-112.3); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-4.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-4.0))-112.3); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-4.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)-110.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.4*(V(s)-V(g)-5.0))-110.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.4*(V(s)-V(g)-5.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)-108.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.2*(V(s)-V(g)-6.0))-108.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	24: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.2*(V(s)-V(g)-6.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	25: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)-105.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	26: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	27: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-105.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pmos90b_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-124.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-124.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)-124.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-124.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld5_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-9.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-9.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-9.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-9.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld10_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-19.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-19.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-19.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-1.0))-19.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-1.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-18.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.2*(V(s)-V(g)-1.5))-18.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.2*(V(s)-V(g)-1.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-2.0); voltageV[2] = abs(V(s)-V(d)-17.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-2.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-17.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld10b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-18.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.0*(V(s)-V(g)-0.0))-18.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-17.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-17.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld30_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-42.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-4.0*(V(s)-V(g)-0.0))-42.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-4.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-44.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.5*(V(s)-V(g)-0.5))-44.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.5*(V(s)-V(g)-0.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)-41.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-41.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld30b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-45.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.3*(V(s)-V(g)-0.0))-45.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.3*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)-43.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.1*(V(s)-V(g)-5.0))-43.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.1*(V(s)-V(g)-5.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)-43.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.0*(V(s)-V(g)-6.0))-43.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.0*(V(s)-V(g)-6.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)-41.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-41.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld45_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-59.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-59.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-59.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-1.5))-59.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.6*(V(s)-V(g)-1.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-2.0); voltageV[2] = abs(V(s)-V(d)-58.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-2.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.3*(V(s)-V(g)-2.0))-58.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.3*(V(s)-V(g)-2.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)-57.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.7*(V(s)-V(g)-3.0))-57.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.7*(V(s)-V(g)-3.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-4.0); voltageV[2] = abs(V(s)-V(d)-55.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-4.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.8*(V(s)-V(g)-4.0))-55.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.8*(V(s)-V(g)-4.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)-55.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(3.3*(V(s)-V(g)-5.0))-55.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(3.3*(V(s)-V(g)-5.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)-51.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.3*(V(s)-V(g)-6.0))-51.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.3*(V(s)-V(g)-6.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)-47.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-47.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld45b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-62.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.6*(V(s)-V(g)-0.0))-62.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.6*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-61.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.3*(V(s)-V(g)-1.5))-61.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.3*(V(s)-V(g)-1.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)-61.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.6*(V(s)-V(g)-2.5))-61.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.6*(V(s)-V(g)-2.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)-60.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.1*(V(s)-V(g)-3.5))-60.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.1*(V(s)-V(g)-3.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)-58.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.1*(V(s)-V(g)-4.5))-58.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.1*(V(s)-V(g)-4.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)-56.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(9.6*(V(s)-V(g)-5.5))-56.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(9.6*(V(s)-V(g)-5.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)-51.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.3*(V(s)-V(g)-6.0))-51.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.3*(V(s)-V(g)-6.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)-47.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-47.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld65_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-91.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-91.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-91.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.4*(V(s)-V(g)-1.0))-91.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.4*(V(s)-V(g)-1.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-90.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.5*(V(s)-V(g)-1.5))-90.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.5*(V(s)-V(g)-1.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)-89.9); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-2.5))-89.9); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-2.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)-89.7); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.4*(V(s)-V(g)-3.5))-89.7); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.4*(V(s)-V(g)-3.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)-88.3); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-4.5))-88.3); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.8*(V(s)-V(g)-4.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)-86.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-86.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld90_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-114.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.8*(V(s)-V(g)-0.0))-114.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.8*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-113.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-1.5))-113.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-1.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-2.0); voltageV[2] = abs(V(s)-V(d)-111.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-2.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.4*(V(s)-V(g)-2.0))-111.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.4*(V(s)-V(g)-2.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)-108.6); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-3.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.8*(V(s)-V(g)-3.0))-108.6); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.8*(V(s)-V(g)-3.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-4.0); voltageV[2] = abs(V(s)-V(d)-103.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-4.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(3.3*(V(s)-V(g)-4.0))-103.8); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(3.3*(V(s)-V(g)-4.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)-100.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(s)-V(g)-5.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-5.0))-100.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-5.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)-100.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(s)-V(g)-6.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-6.0))-100.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-6.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)-96.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(s)-V(g)-7.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-96.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld90b_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-124.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-124.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)-124.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(3.0*(V(s)-V(g)-2.5))-124.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(3.0*(V(s)-V(g)-2.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)-121.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-3.5))-121.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-3.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)-121.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(6.0*(V(s)-V(g)-4.5))-121.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(6.0*(V(s)-V(g)-4.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)-115.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-115.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld100_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-127.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.0*(V(s)-V(g)-0.0))-127.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(2.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-126.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-0.5))-126.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-0.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-124.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-1.0))-124.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-1.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-124.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.0*(V(s)-V(g)-1.5))-124.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.0*(V(s)-V(g)-1.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)-123.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-2.5))-123.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-2.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)-119.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(3.0*(V(s)-V(g)-3.5))-119.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(3.0*(V(s)-V(g)-3.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)-116.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-4.5))-116.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-4.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)-116.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-116.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_nmos120_10hv(d,g,s,b,sub);
input d,g,s,b,sub;
electrical d,g,s,b,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = abs(V(d)-V(s)-165.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	2: begin voltageV[1] = abs(V(g)-V(s)-0.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	3: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(5.0*(V(g)-V(s)-0.0))-165.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	4: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(5.0*(V(g)-V(s)-0.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	5: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = abs(V(d)-V(s)-163.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	6: begin voltageV[1] = abs(V(g)-V(s)-0.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	7: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5))-163.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	8: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-0.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	9: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = abs(V(d)-V(s)-163.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	10: begin voltageV[1] = abs(V(g)-V(s)-1.0); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	11: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.0*(V(g)-V(s)-1.0))-163.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	12: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.0*(V(g)-V(s)-1.0)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	13: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = abs(V(d)-V(s)-163.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	14: begin voltageV[1] = abs(V(g)-V(s)-1.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	15: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(4.8*(V(g)-V(s)-1.5))-163.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	16: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(4.8*(V(g)-V(s)-1.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	17: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = abs(V(d)-V(s)-158.2); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	18: begin voltageV[1] = abs(V(g)-V(s)-2.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	19: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(2.7*(V(g)-V(s)-2.5))-158.2); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	20: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(2.7*(V(g)-V(s)-2.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	21: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = abs(V(d)-V(s)-155.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	22: begin voltageV[1] = abs(V(g)-V(s)-3.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	23: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(1.4*(V(g)-V(s)-3.5))-155.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	24: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(1.4*(V(g)-V(s)-3.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	25: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = abs(V(d)-V(s)-154.1); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	26: begin voltageV[1] = abs(V(g)-V(s)-4.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	27: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = abs(V(d)-V(s)+(-0.3*(V(g)-V(s)-4.5))-154.1); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	28: begin voltageV[1] = V(g)-V(s); voltageV[2] = V(g)-V(s); voltageV[3] = V(d)-V(s)+(-0.3*(V(g)-V(s)-4.5)); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	29: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = abs(V(d)-V(s)-154.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	30: begin voltageV[1] = abs(V(g)-V(s)-5.5); voltageV[2] = V(d)-V(s); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	31: begin voltageV[1] = V(g)-V(s); voltageV[2] = abs(V(d)-V(s)-154.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(b)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule

module monitor_esd_pld120_10hv(d,g,s,sub);
input d,g,s,sub;
electrical d,g,s,sub;
parameter real ruleNum = 1;
parameter real targetT = 0;
parameter real enable = 1;
parameter string device1 = "fet";
parameter string current_probe1 = "1";
parameter string device2 = "fet";
parameter string current_probe2 = "1";
parameter string rule = "Over voltage";
parameter real monitorType_cond1 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond1 = 1; 
parameter real ruleType_cond1 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond1  = 1;
parameter string formulae_cond1   = "a+b>1";
parameter real monitorType_cond2 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond2 = 1; 
parameter real ruleType_cond2 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond2  = 1;
parameter string formulae_cond2   = "a+b>1";
parameter real monitorType_cond3 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond3 = 1; 
parameter real ruleType_cond3 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond3  = 1;
parameter string formulae_cond3   = "a+b>1";
parameter real monitorType_cond4 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond4 = 1; 
parameter real ruleType_cond4 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond4  = 1;
parameter string formulae_cond4   = "a+b>1";
parameter real monitorType_cond5 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond5 = 1; 
parameter real ruleType_cond5 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond5  = 1;
parameter string formulae_cond5   = "a+b>1";
parameter real monitorType_cond6 = 0; // 0, default; 1, voltage; 2, current; 3, parameter; 4, current+current
parameter real realParameter_cond6 = 1; 
parameter real ruleType_cond6 = 1; // 1, >; 2, >=; 3, <; 4, <=; 5, ==; 6, !=
parameter real targetV_cond6  = 1;
parameter string formulae_cond6   = "a+b>1";
integer fp;
real state,violInit,score[1:6],deltaOverValue[1:6];
real flag,totalFlag,targetT_real;
real monitorType[1:6],realParameter[1:6],ruleType[1:6],targetV[1:6],realV[1:6],voltageV[1:6],maxV[1:6];
integer j; 
real ruleNum_var;
  
analog begin
if ( enable == 1 ) begin 
	targetT_real =  targetT * 1.0e-9;
	@(initial_step) begin
   		fp = $fopen(`MONITOR_LOGFILE, "w");
		state = 0;
		monitorType[1] = monitorType_cond1;
		realParameter[1] = realParameter_cond1;
		ruleType[1] = ruleType_cond1;
		targetV[1] = targetV_cond1;
		monitorType[2] = monitorType_cond2;
		realParameter[2] = realParameter_cond2;
		ruleType[2] = ruleType_cond2;
		targetV[2] = targetV_cond2;
		monitorType[3] = monitorType_cond3;
		realParameter[3] = realParameter_cond3;
		ruleType[3] = ruleType_cond3;
		targetV[3] = targetV_cond3;
		monitorType[4] = monitorType_cond4;
		realParameter[4] = realParameter_cond4;
		ruleType[4] = ruleType_cond4;
		targetV[4] = targetV_cond4;
		monitorType[5] = monitorType_cond5;
		realParameter[5] = realParameter_cond5;
		ruleType[5] = ruleType_cond5;
		targetV[5] = targetV_cond5;
		monitorType[6] = monitorType_cond6;
		realParameter[6] = realParameter_cond6;
		ruleType[6] = ruleType_cond6;
		targetV[6] = targetV_cond6;
	end
	ruleNum_var = ruleNum;
	case(ruleNum_var)
	default voltageV[1] = abs(V(g)-V(s));
	1: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)-142.3); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	2: begin voltageV[1] = abs(V(s)-V(g)-0.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	3: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))-142.3); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	4: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-0.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	5: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)-142.3); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	6: begin voltageV[1] = abs(V(s)-V(g)-0.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	7: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(9.6*(V(s)-V(g)-0.5))-142.3); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	8: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(9.6*(V(s)-V(g)-0.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	9: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)-137.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	10: begin voltageV[1] = abs(V(s)-V(g)-1.0); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	11: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-1.0))-137.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	12: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(4.0*(V(s)-V(g)-1.0))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	13: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)-135.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	14: begin voltageV[1] = abs(V(s)-V(g)-1.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	15: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-1.5))-135.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	16: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(-0.0*(V(s)-V(g)-1.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	17: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)-135.5); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	18: begin voltageV[1] = abs(V(s)-V(g)-2.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	19: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.1*(V(s)-V(g)-2.5))-135.5); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	20: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(1.1*(V(s)-V(g)-2.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	21: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)-134.4); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	22: begin voltageV[1] = abs(V(s)-V(g)-3.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	23: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(9.4*(V(s)-V(g)-3.5))-134.4); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	24: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(9.4*(V(s)-V(g)-3.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	25: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)-125.0); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	26: begin voltageV[1] = abs(V(s)-V(g)-4.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	27: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-4.5))-125.0); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	28: begin voltageV[1] = V(s)-V(g); voltageV[2] = V(s)-V(g); voltageV[3] = abs(V(s)-V(d)+(0.2*(V(s)-V(g)-4.5))); voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	29: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)-124.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	30: begin voltageV[1] = abs(V(s)-V(g)-5.5); voltageV[2] = abs(V(s)-V(d)); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	31: begin voltageV[1] = V(s)-V(g); voltageV[2] = abs(V(s)-V(d)-124.8); voltageV[3] = 100; voltageV[4] = 100; voltageV[5] = 100; voltageV[6] = 100+0*(V(d)+V(g)+V(s)+V(sub)); end
	endcase
	totalFlag = 0;
	for (j = 1; j < 7; j = j + 1) begin
		if ( monitorType[j] > 0 ) begin 
			if ( monitorType[j] == 1 || monitorType[j] == 6) begin
				realV[j] = voltageV[j];
			end else if ( monitorType[j] == 5 ) begin
				realV[j] = abs(voltageV[j]);
			end else if ( monitorType[j] == 2 ) begin
				@(initial_step) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1));
				end
				//$display ("---- %s, %e",formulae_cond1, realV[j]); 
			end else if ( monitorType[j] == 4 ) begin
				@(initial_step) begin
				//Ibody = abs(In1 - In2)
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end  
				if(analysis("dc", "tran")) begin
					realV[j] = abs($simprobe(device1,current_probe1)+$simprobe(device2,current_probe2));
				end
				//$display ("---- %e, %e",$simprobe(device1,current_probe1), $simprobe(device2,current_probe2)); 
			end else begin
				realV[j] = realParameter[j];
			end
			if ( monitorType[j] == 6 ) begin
				targetV[j] = $simprobe(device1,current_probe1);
			end
			if ( realV[j] > targetV[j] && ruleType[j] == 1 ) begin
				flag = 1;
			end else if ( realV[j] >= targetV[j] && ruleType[j] == 2 ) begin
				flag = 1;
			end else if ( realV[j] < targetV[j] && ruleType[j] == 3 ) begin
				flag = 1;
			end else if ( realV[j] <= targetV[j] && ruleType[j] == 4 ) begin
				flag = 1;
			end else if ( realV[j] == targetV[j] && ruleType[j] == 5 ) begin
				flag = 1;
			end else if ( realV[j] != targetV[j] && ruleType[j] == 6 ) begin
				flag = 1;
			end else begin
				flag = 0;
			end
		end else begin
			realV[j] = 1;
			flag = 1;
		end
		totalFlag = flag + totalFlag;
	end

	
	if ( totalFlag == 6 ) begin
		if (state == 0) begin
			state = 1;
			violInit = $abstime;
			maxV[1] = realV[1];
			maxV[2] = realV[2];
			maxV[3] = realV[3];
			maxV[4] = realV[4];
			maxV[5] = realV[5];
			maxV[6] = realV[6];
		end else begin
			if ( abs(realV[1]) > abs(maxV[1]) ) maxV[1] = realV[1];
			if ( abs(realV[2]) > abs(maxV[2]) ) maxV[2] = realV[2];
			if ( abs(realV[3]) > abs(maxV[3]) ) maxV[3] = realV[3];
			if ( abs(realV[4]) > abs(maxV[4]) ) maxV[4] = realV[4];
			if ( abs(realV[5]) > abs(maxV[5]) ) maxV[5] = realV[5];
			if ( abs(realV[6]) > abs(maxV[6]) ) maxV[6] = realV[6];
		end
	end else begin
		if (state == 1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if (($abstime-violInit >= targetT_real && targetT_real >= 0) || ($abstime-violInit < -targetT_real && targetT_real < 0)) begin
						if ( j == 1 ) begin
							$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 2 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 3 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 4 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 5 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
						if ( j == 6 ) begin
							$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
						end						
					end
				end		
			end 
			state=0;
		end
	end
	@(final_step) begin
		if (state==1) begin
			for (j = 1; j < 7; j = j + 1) begin
				if ( monitorType[j] > 0 ) begin 
					if (targetV[j] == 0) begin
						deltaOverValue[j] = 0;
					end else begin
						deltaOverValue[j] = (abs(maxV[j])-abs(targetV[j]))/abs(targetV[j]);
						score[j]= (deltaOverValue[j]*($abstime-violInit))*1e9+score[j];
					end
					if ( j == 1 ) begin
						$fwrite(fp,"%m,%s,%s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond1, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 2 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond2, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 3 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond3, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 4 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond4, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 5 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond5, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
					if ( j == 6 ) begin
						$fwrite(fp,"%m,%s,&& %s,%g,%g,%g,%g,%g,%g\n",rule,formulae_cond6, violInit,$abstime,$abstime-violInit,maxV[j],deltaOverValue[j], score[j]);
					end						
				end		
			end 
		end 
	end
end
end
endmodule


